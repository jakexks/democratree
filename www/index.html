<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
        <link rel="stylesheet"  href="css/themes/default/jquery.mobile-1.3.2.min.css">
		<style type="text/css">
		  #map-canvas { height: 100%}
		</style>
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript">
            var dd = $.Deferred();
            var jqd = $.Deferred();
            $.when(dd, jqd).done(doInit);

            $(document).bind('mobileinit', function () {
                jqd.resolve();
            });
            function doInit() {
                FastClick.attach(document.body);
                var ele = document.getElementById("deviceproperties");
                ele.innerHTML = 'Device Model: '    + device.model    + '<br />' +
                            	'Device Cordova: '  + device.cordova  + '<br />' +
                            	'Device Platform: ' + device.platform + '<br />' +
        		                'Device UUID: '     + device.uuid     + '<br />' +
		                        'Device Version: '  + device.version  + '<br />';

            }
            $.support.cors = true;
            $.mobile.allowCrossDomainPages = true;
            $.mobile.buttonMarkup.hoverDelay = 10;
        </script>
        <script type="text/javascript" src="js/jquery.mobile-1.3.2.min.js"></script>
        <script type="application/javascript" src="js/fastclick.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript">
            document.addEventListener('deviceready', deviceReady, false);
            function deviceReady() {
                dd.resolve();
            }
        </script>
		<script type="text/javascript"
		  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDb1xlbN5xo9lZcWAIn-OQKm1jH56xs904&libraries=places&amp;sensor=false">
		</script>
        <script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"></script>
		<script type="text/javascript">
            function initialize() {
                var mapOptions = {
                    center: new google.maps.LatLng(51.455, -2.588),
                    zoom: 13
                };
                var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);

                // Listen for clicks to add labels
                google.maps.event.addListener(map, 'click', function(event) {
                    placeMarker(event.latLng, map);
                });

                
                // Create the search box and link it to the UI element.
                var input = document.getElementById('search-input');
                //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

                var searchBox = new google.maps.places.Autocomplete(input);

                // Listen for the event fired when the user selects an item from the
                // pick list. Retrieve the matching place for that item.
                google.maps.event.addListener(searchBox, 'place_changed', function() {
                    var place = searchBox.getPlace();
                    map.setCenter(place.geometry.location);
                    map.setZoom(17);
                });
                
                // Bias the SearchBox results towards places that are within the bounds of the
                // current map's viewport.
                google.maps.event.addListener(map, 'bounds_changed', function() {
                    var bounds = map.getBounds();
                    searchBox.setBounds(bounds);
                });



                
                // Set height
                h = $(window).height();
				document.getElementById('map-canvas').style.height = h-120+"px"; // Under the assumption header/footer are 60px tall, may need changing
            }

            

            // Function to place marker
            function placeMarker(location, map) {
                var marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    title: 'Tree/username',    
                    animation: google.maps.Animation.DROP,
                    icon: 'img/tree1.png'
                });
                attachMessage(marker);
                map.panTo(position);
            }

            // Attaches infowindow to each marker
            function attachMessage(marker) {
                var msggg = 'You have voted for me!';
                var contentString = '<p><b>First tree</b><p>The first tree to be planted in Bristol will be a large Ash tree in the city centre.<button type="button" onclick="prompt("gg")">Vote for me!</button>';

                // var boxText = document.createElement("div");
                // boxText.style.cssText = "border: 2px solid black; margin-top: 10px; background: grey; padding: 10px;";
                // boxText.innerHTML = "<p><b>First tree</b><p>The first tree to be planted in Bristol will be a large Ash tree in the city centre.";        
                // infobox = new InfoBox({
                //      content: boxText,
                //      disableAutoPan: false,
                //      maxWidth: 150,
                //      pixelOffset: new google.maps.Size(-140, 0),
                //      zIndex: null,
                //      boxStyle: {
                //         background: "url('http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/examples/tipbox.gif') no-repeat",
                //         opacity: 0.75,
                //         width: "280px"
                //     },
                //     closeBoxMargin: "16px 8px 6px 6px",
                //     closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif",
                //     infoBoxClearance: new google.maps.Size(1, 1)
                // });

                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                })

                // google.maps.event.addListener(marker, 'click', function() {
                //     infobox.open(marker.get('map'), this);
                //     map.panTo(loc);
                // });
                
                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(marker.get('map'),marker);
                });
                
            }

            


            google.maps.event.addDomListener(window, 'load', initialize);
		</script>
        <title>Democratree</title>
    </head>

    <body> 

        <!-- map page -->
        <div data-role="page" id="map_page">

            <div data-role="header" data-position="fixed" data-id="fixed_header">
                <a data-icon="bars" href="#map_left_panel" data-iconpos="notext">Menu</a>
                <h1>Map</h1>
            </div><!-- /header -->
            
            <div data-role="content" id="map-canvas">
                <div id="deviceproperties"></div>
            </div><!-- /content -->
			
            <div data-role="footer" data-position="fixed" data-id="fixed_footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->

            <div data-role="panel" id="map_left_panel">
                <ul data-role="listview">
                    <li data-role="list-divider">Democratree</li>
                    <li><a href="#leaderboard_page">Leaderboard</a></li>
                    <li><input id="search-input" data-mini="true" data-clear-btn="true" type="text" placeholder="Search"></li>
                </ul>
                
            </div><!-- /panel -->

        </div><!-- /page -->


        <!-- Start of second page -->
        <div data-role="page" id="leaderboard_page">

            <div data-role="header" data-position="fixed" data-id="fixed_header">
                <a data-icon="bars" href="#leaderboard_left_panel" data-iconpos="notext">Menu</a>
                <h1>Leaderboard</h1>
            </div><!-- /header -->

            <div data-role="content">   
                <p>Leaderboard Leaderboard Leaderboard Leaderboard Leaderboard Leaderboard </p>      
            </div><!-- /content -->

            <div data-role="footer" data-position="fixed" data-id="fixed_footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->

            <div data-role="panel" id="leaderboard_left_panel">
                <ul data-role="listview">
                    <li data-role="list-divider">Democratree</li>
                    <li><a href="#map_page">Map</a></li>
                </ul>
            </div><!-- /panel -->
        </div><!-- /page -->
    </body>
</html>
